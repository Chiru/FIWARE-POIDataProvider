<html>
<head>
  <title>TEST sbje_json_edit.js</title>
      
  <script type="text/javascript" src="sbje_json_edit.js"></script>

</head>
<body>
  <h2><code>sbje_jeson_edit.js</code> Test</h2>

  <div style="float:left;width:50%">
    <button id="button_sbje" type="button" onclick="click_sbje()">
        Save</button>
    <div id="sbje">
      [empty]
    </div>
  </div>
  <div style="float:left;width:49%">
    <button id="button_text" type="button" onclick="click_text()">
        Save</button>
    <div>
      <textarea id="text" rows="25" cols="80">{
  "a": "some text",
  "b": {
    "avain1": "Avain 1",
    "toinen_avain": "- ja siihenkin juttua"
  }
}  
      </textarea>
    </div>
    <div id="status">
    </div>
  </div>

<script>
<!--
"use strict"; // reveal bad scripting

var user_schema = {
  "title": "User information",
  "description": "For user identification",
  "type": "object",
  "properties": {
    "name": {
      "title": "Name of the user",
      "description": "as convenient",
      "type": "string"
    },
    "email": {
      "title": "E-mail address",
      "description": "for invitation to register, etc.",
      "type": "string",
      "format": "email"
    },
    "permissions": {
      "title": "Access permissions",
      "description": "What the user can do.",
      "type": "object",
      "properties": {
        "admin": {
          "title": "Administrator",
          "description": "Everything is permitted",
          "type": "boolean"
        },
        "add": {
          "title": "Add POI",
          "description": "Adding a POI is permitted",
          "type": "boolean"
        },
        "update": {
          "title": "Update POI",
          "description": "Updating and deleting a POI is permitted",
          "type": "boolean"
        },
        "view": {
          "title": "View",
          "description": "Viewing a POI is permitted",
          "type": "boolean"
        }
      }
    },
    "address": {
      "title": "Postal address",
      "description": "Use comma to separate lines",
      "type": "string"
    },
    "phone": {
      "title": "Phone number",
      "description": "as convenient",
      "type": "string"
    },
    "last_update": {
      "title": "Last update",
      "description": "DO NOT EDIT! Information to identify the version of the data component.",
      "$ref": "#/definitions/update_stamp"
    },
    "identifications": {
      "description": "key is <auth_provider>:<auth_id>",
      "type": "object",
      "additionalProperties": {
        "type": "boolean"
      }
    }
  },
  "required": [
    "name",
    "email"
  ],
  "additionalProperties": false,
  "definitions": {
    "update_stamp": {
      "type": "object",
      "fw_read_only": true,
      "properties": {
        "timestamp": {
          "description": "When updated - to catch conflicts (unix timestamp format)",
          "type": "integer"
        },
        "responsible": {
          "description": "Who updated, UUID of the profile",
          "type": "string"
        }
      },
      "required": [
        "timestamp"
      ],
      "additionalProperties": false
    }
  }
};

var data_buffer = {};


function click_text() {
  var data1 = document.getElementById("text").value;
  
  data_buffer = JSON.parse(data1);

  sbje.make_form("sbje", user_schema, 
      data_buffer, document);

}


function click_sbje() {

  var data1 = JSON.stringify(data_buffer, null, "  ");
  document.getElementById("text").value = data1;

}

window.onload = function() {
  click_text();
}


//-->
</script>
</body>
</html>
